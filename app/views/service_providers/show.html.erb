<section>
    <div class="second-page-container">
        <div class="block">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="block-breadcrumb">
                            <ul class="breadcrumb">
                                <li><a href="#">Home</a></li>
                                <li><a href="#">Domain</a></li>
                                <li class="active">Service Providers</li>
                            </ul>
                        </div>

                        <div class="header-for-light">
                            <h1 class="wow fadeInRight animated" data-wow-duration="1s"> <span><%= @service_provider.name %></span> </h1>

                        </div>

                        <div class="block-product-detail">
                            <div class="row">
                                <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
                                    <div class="product-image">
                                    <%= image_tag(@service_provider.picture.avatar_url , class: "img-responsive", alt: "", title: "", :style => "height:400px;width:400px;") rescue image_tag("img/preview/product5-1.jpg", class: "img-responsive", alt: "", title: "") %>
                                
                                    </div>
                                </div>
                                <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">


                                    <div class="product-detail-section">
                                        <!-- <h3><%#= @service_provider.user.first_name %> <%#= @service_provider.domain.name %></h3> -->
                                        <h4><label class="pull-left">Category:</label><%= @service_provider.domain.name %></h4>
                                        <div class="product-rating">
                                            <div class="stars">
                                            <label class="pull-left" style="direction: ltr;">Reviews:</label>
                                               <% @rate_avg.times do |t| %>
                                               <span class="star active"></span>
                                               <% end %>
                                            </div>
                                            <a href="" class=""><%= @service_provider.comments.count %> Reviews</a> 
                                        </div>

                                        <div class="product-information">
                                            <div class="clearfix"> 
                                                <label class="pull-left">Language:</label> 
                                                <%= @service_provider.languages.collect(&:name).to_s.delete "[]" %>
                                            </div>
                                            <%= simple_form_for(@cart, defaults: { input_html: { class: '' } }) do |f| %>
                                            <div class="clearfix">
                                                <label class="pull-left">Date:</label>
                                                <%= f.text_field :start_date, id: 'datepicker', readonly: true, class: "form-control" %>
                                                <%= f.hidden_field :service_provider_id, :value => @service_provider.id %>
                                                    <!-- <span class="fa fa-calendar"></span> -->
                                            </div>
                                            <div class="clearfix">
                                                <label class="pull-left">Time(24 Hrs):</label>
                                                <%= f.select :reporting_time,  options_for_select(1..23), { prompt: "flexible" }, {class: "form-control"} %>
                                            </div>


                                            <div class="clearfix">
                                                <label class="pull-left">Price Type:</label>
                                                <%= select_tag :price_type, options_for_select(Price.price_types), :class => 'form-control' %>
                                                <!-- <select name="size" class="form-control">
                                                    <option value="1" selected="selected">Minimum_charge</option>
                                                    <option value="2">Hourly</option>
                                                    <option value="0">Fixed</option>
                                                </select> -->
                                            </div>

                                            <div class="clearfix hide" id="hide-hourly-ele">
                                                <label class="pull-left">Hours:</label>
                                                <div class="form-group">
                                                <%= f.select(:hours, (0..20), {}, { :class => 'form-control' }) %>
                                                </div>
                                            </div>
                                            <div class="clearfix">
                                                <label class="pull-left">Total:</label>
                                                <p class="product-price product-price-total"><i class="fa fa-rupee"></i>  <%= @service_provider.prices.minimum_charge.first.amount rescue 0 %></p>
                                            </div> 
                                            <div class="clearfix">
                                               <p class="form-width-full">Note: (This amount is not final and the final amount will be decided between you and the service provider)</p>
                                            </div>
                                            <div class="clearfix">
                                                <!-- <label class="pull-left">Description:</label> -->
                                                <%= f.input_field :description, placeholder: "Description", class: "form-control form-width-full" %>
                                                    <!-- <span class="fa fa-calendar"></span> -->
                                            </div>
                                            <div class="shopping-cart-buttons">
                                                <%= button_tag(type: 'submit', class: "btn btn-primary btn-lg shoping")  do %>
                                                    <i class="fa fa-shopping-cart"></i> Book Now
                                                <% end %>
                                                <%= button_tag(type: 'submit', class: "btn btn-primary btn-lg shoping")  do %>
                                                    <i class="fa fa-plus"></i> Shortlist
                                                <% end %>
                                            </div>

                                            <% end %>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="box-border block-form">
                            <!-- Nav tabs -->
                            <ul class="nav nav-pills  nav-justified">
                                <li class="active"><a href="#description" data-toggle="tab">Description</a></li>
                                <li><a href="#additional" data-toggle="tab" class="disabled">Additional</a></li>
                                <li><a href="#review" data-toggle="tab">Review</a></li>
                            </ul>

                            <!-- Tab panes -->
                            <div class="tab-content">
                                <div class="tab-pane active" id="description">
                                    <br>
                                    <h3>Details</h3>
                                    <hr>
                                    <p>
                                       <%= @service_provider.description %>
                                    </p>
                                </div>
                                <div class="tab-pane" id="additional">
                                    <br>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <h3>Address</h3>
                                            <hr>
                                            <h4><%= @service_provider.address.address_type rescue nil%></h4>
                                            <p><%= @service_provider.address.mobile rescue nil%></p>
                                            <p><%= @service_provider.address.telephone rescue nil%></p>
                                            <p>
                                                <%= @service_provider.address.street1 %>, 
                                                <%= @service_provider.address.street2 %>, 
                                                <%= @service_provider.address.city %>, 
                                                <%= @service_provider.address.state %>, 
                                                <%= @service_provider.address.pincode %>
                                            </p>
                                            
                 

                                        </div>
                                        <div class="col-md-4 block-color">
                                            <h3>Skills</h3>
                                            <hr>
                                            <ul class="colors clearfix list-unstyled">
                                                <% @service_provider.skills.each do |skill| %>
                                                <li><a href="" rel=""><%= skill.name %> </a></li>
                                                <% end %>
                                            </ul>

                                        </div>
                                        <div class="col-md-4">
                                            <h3>I am Available for work </h3>
                                            <hr>
                                            <p>
                                                <%= @service_provider.notice_period %> Days
                                            </p>
                                        </div>
                                    </div>

                                </div>
                                <div class="tab-pane" id="review">
                                    
                                    <div class="product-rating">
                                        <h1> Communication  :</h1> <%= rating_for @service_provider, "communication", disable_after_rate: true, imdb_avg: true, cancel_hint: 'Cant say' %>
                                        <h1>Efficiency :</h1> <%= rating_for @service_provider, "efficiency", disable_after_rate: true, imdb_avg: true, cancel_hint: 'Cant say' %>
                                        <h1>Price  :</h1> <%= rating_for @service_provider, "price", disable_after_rate: true, imdb_avg: true, cancel_hint: 'Cant say' %>
                                        <h1>Punctuality  :</h1> <%= rating_for @service_provider, "punctuality", disable_after_rate: true, imdb_avg: true, cancel_hint: 'Cant say' %>
                                        <h1>Overall  :</h1> <%= rating_for @service_provider, "overall", disabled_after_rate: true, imdb_avg: true, cancel_hint: 'Cant say' %>
                                    </div>
                                    <% if current_user  %>

                                        <% if @service_provider.comments.where(user_id: current_user.id).blank?   %>
                                            <%= simple_form_for(@comment, remote: true) do |f| %>
                                              <%#= f.error_notification %>
                                              <%= f.hidden_field :service_provider_id, value: @service_provider.id %>
                                               <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                        <%= f.input_field :description, class: "form-control", placeholder: "Type Feedback" %>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">

                                                        </div>
                                                    </div>
                                                </div>

                                                <%= f.button :submit, "Add Review" %>
                           
                                            <% end %>
                                        <% end %>
                                    <% end %>
                                    <br>
                                    <% if !@comments.blank? %>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h3>Clients review</h3>
                                            <% @comments.each do |com| %>
                                                <div class="review-header">
                                                    <h5><%= com.user.full_name rescue nil %></h5>
                                                  <!--   <div class="product-rating">
                                                        <div class="stars">
                                                            <span class="star active"></span><span class="star active"></span><span class="star active"></span><span class="star active"></span><span class="star active"></span>
                                                        </div>
                                                    </div> -->
                                                    <small class="text-muted"><%= com.created_at %></small>
                                                </div>
                                                <div class="review-body">
                                                    <p><%= com.description %></p>

                                                </div>
                                            <hr>
                                            <% end %>
                                        </div>
                                    </div>
                                    <% end %>


                                </div>

                            </div>



                        </div>



                    </div>

                </div>
            </div>
        </div>
    </div>
</section>        


<script type="text/javascript">

    var d = new Date(),
        month = '' + (d.getMonth() + 1),
        day = '' + (d.getDate() + 1),
        year = d.getFullYear();

    if (month.length < 2) month = '0' + month;
    if (day.length < 2) day = '0' + day;
    var date_from = [year, month, day].join('/');

    $(function () {
        $('#datepicker').datepicker({
            format: 'yyyy/mm/dd',
            startDate: date_from,
            // endDate: '2015/12/31',
            autoclose: 1,
            todayHighlight: 1
        });
        // $('#cart_reporting_time_5i').remove();
    });

    $(function () {
        $("#new_comment").submit(function(e) {
            $("#new_comment").hide();
        });
    });
jQuery.validator.setDefaults({
  debug: true,
  success: "valid"
});
    $(function() {
         $("#new_cart").validate({
                rules: {
                    "cart[start_date]": { 
                        required: true,
                        date: true
                    },
                    "cart[description]": "required",
                    "cart[reporting_time(4i)]": "required"
                },
                messages: {
                    "cart[description]": "Please enter description",
                    "cart[reporting_time(4i)]": "Please enter your suitable time",
                    "cart[start_date]": {
                        required: "Please provide required date",
                        date: "Please select a valid date"
                    }
                },
                submitHandler: function(form) {
                    form.submit();
                }
            });
    });

    var total = 0;
    $("#price_type").on('change', function(){
     
       if ($("#price_type option:selected").text() == "hourly"){
        $("#hide-hourly-ele").removeClass('hide');
       } else {
        $("#hide-hourly-ele").addClass('hide');
       }
        switch ($("#price_type option:selected").text()) {
            case 'one_time':
                total = "<%= @service_provider.prices.one_time.first.amount rescue 0 %>";
                // console.log('fixed', total);
                break;
            case 'monthly':
                total = "<%= @service_provider.prices.monthly.first.amount rescue 0 %>";
                // console.log('fixed', total);
                break;
            case 'yearly':
                total = "<%= @service_provider.prices.yearly.first.amount rescue 0 %>";
                // console.log('fixed', total);
                break;
            case 'minimum_charge':
                total = "<%= @service_provider.prices.minimum_charge.first.amount rescue 0 %>";
                // console.log('minimum_charge', total);
                break;
            case 'hourly':
                total = "<%= @service_provider.prices.hourly.first.amount rescue 0 %>";
                // console.log('hourly', total);
                break;
            // default:
                // total = "<%#= @service_provider.prices.minimum_charge.first.amount rescue 0 %>"
                // console.log('default', total);
        };
        $('.product-price-total').html('<i class="fa fa-rupee"></i>  ' + total)

    })

    $("#cart_hours").on('change', function(){
        // console.log(parseInt($("#cart_hours option:selected").val()))
        // console.log(total)
        var total2 = parseInt($("#cart_hours option:selected").val()) * total;
        // console.log(total2)

       $('.product-price-total').html('<i class="fa fa-rupee"></i>  ' + total2);
    })
    
</script>
